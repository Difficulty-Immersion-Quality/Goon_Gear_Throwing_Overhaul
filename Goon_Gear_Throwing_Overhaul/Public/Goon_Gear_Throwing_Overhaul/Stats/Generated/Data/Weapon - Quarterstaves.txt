// ==================================== Gold Wyrmling Staff ====================================
// Changes: The staff is now visible in cutscenes.

new entry "MAG_Fire_FireDamage_Quarterstaff"
type "Weapon"
// using "WPN_Quarterstaff_1"
using "MAG_Fire_FireDamage_Quarterstaff"
// data "DefaultBoosts" "WeaponEnchantment(1);WeaponProperty(Magical);HiddenDuringCinematic()"
data "DefaultBoosts" "WeaponEnchantment(1);WeaponProperty(Magical)"

// ==================================== Staff of the Ram ====================================
// Bug Fix: Missing 1d6 Force damage is now present.
// Bug Fix: Saving Throws for the knockback now only triggered on hits and not misses.
// Changes: Added adjustable push trajectory. Split the stun from the push, when you successfully push a target they will get to roll an additional saving throw to avoid the stun. To account for it now being 2 save DCs they're both ManeuverSaveDC +2 instead of a fixed DC of 8, as they both have to be failed to stun.

new entry "MAG_LC_OfTheRam_Quarterstaff"
type "Weapon"
// using "WPN_Quarterstaff_2"
using "MAG_LC_OfTheRam_Quarterstaff"
// data "DefaultBoosts" "WeaponEnchantment(2);WeaponProperty(Magical)"
data "DefaultBoosts" "WeaponEnchantment(2);WeaponProperty(Magical);WeaponDamage(1d6,Force)"

new entry "MAG_StaffOFRam_KnockStun_Passive"
type "PassiveData"
using "MAG_StaffOFRam_KnockStun_Passive"
data "TooltipSave" "Constitution"
// Once per turn, the blow possibly knocks a foe back [1] and &lt;LSTag Type="Status" Tooltip="STUNNED"&gt;Stuns&lt;/LSTag&gt; them. This has no effect on dragons or Huge creatures.
// data "Description" "h30031d03gc514g4b3bgbe22g85ef148cc2e7;6"
// Once per turn, the blow possibly knocks a foe back [1] unless they succeed a &lt;LSTag Tooltip="Constitution"&gt;Constitution&lt;/LSTag&gt; &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throw&lt;/LSTag&gt;. If the target is knocked back they must succeed an additional &lt;LSTag Tooltip="Constitution"&gt;Constitution&lt;/LSTag&gt; &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throw&lt;/LSTag&gt; or be &lt;LSTag Type="Status" Tooltip="STUNNED"&gt;Stuns&lt;/LSTag&gt; for [2]. This has no effect on dragons or Huge creatures.
data "Description" "h891a0892ga83fg4a5egb6fag36fb3e6ec70c;1"
// data "DescriptionParams" "Distance(2)"
data "DescriptionParams" "Distance(2);1"
// data "Conditions" "AttackedWithPassiveSourceWeapon() and not Ally() and TargetSizeEqualOrSmaller(Size.Large) and not Tagged('DRAGON') and not SavingThrow(Ability.Constitution, 8, false, false, context.Target)"
data "Conditions" "AttackedWithPassiveSourceWeapon() and not IsMiss() and TargetSizeEqualOrSmaller(Size.Large) and not Tagged('DRAGON');"
// data "StatsFunctors" "IF(not Ally()):Force(2,OriginToEntity,Aggressive);IF(Ally()):Force(2,OriginToEntity,Friendly);ApplyStatus(STUNNED, 100, 1)"
data "StatsFunctors" "IF(not Ally() and not SavingThrow(Ability.Constitution, ManeuverSaveDC()+2)):Force(2,OriginToTarget,Aggressive);IF(Ally()):Force(2,OriginToTarget,Friendly);ApplyStatus(STUNNED, 100, 1)"

new entry "GOON_STAFFOFRAM_STUN_TECHNICAL"
type "StatusData"
data "StatusType" "BOOST"
// Staff of the Ram
data "DisplayName" "hae01b6e8g91cfg4b88gbcfag30ed8a070ac8;2"
// Once per turn, the blow possibly knocks a foe back [1] unless they succeed a &lt;LSTag Tooltip="Constitution"&gt;Constitution&lt;/LSTag&gt; &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throw&lt;/LSTag&gt;. If the target is knocked back they must succeed an additional &lt;LSTag Tooltip="Constitution"&gt;Constitution&lt;/LSTag&gt; &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throw&lt;/LSTag&gt; or be &lt;LSTag Type="Status" Tooltip="STUNNED"&gt;Stuns&lt;/LSTag&gt; for [2]. This has no effect on dragons or Huge creatures.
data "Description" "h891a0892ga83fg4a5egb6fag36fb3e6ec70c;1"
data "DescriptionParams" "Distance(2);1"
data "StatusPropertyFlags" "DisablePortraitIndicator;DisableOverhead;DisableCombatlog"
data "OnApplyFunctors" "IF(not SavingThrow(Ability.Constitution, ManeuverSaveDC()+2)):ApplyStatus(STUNNED, 100, 1)""

// ==================================== Staff of Interruption ====================================
// Bug Fix: Now uses the appropriate level of Counterspell, 5 instead of 3.

new entry "Interrupt_MAG_Counterspell"
type "InterruptData"
// using "Interrupt_Counterspell"
using "Interrupt_Counterspell_5"
// Counterspell
data "DisplayName" "h5ca745ecg0d79g4621gaa12g1fe3e6164a69;1"
// data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Target_MAG_CounterSpell_Success,true,true,true)"
data "Cost" "ReactionActionPoint:1;Interrupt_MAG_Counterspell:1"
data "Cooldown" "OncePerRestPerItem"
// data "EnableCondition" "HasActionResource('Interrupt_MAG_Counterspell', 1, 0, false, false, context.Source)"
data "EnableCondition" "(HasActionResource('Interrupt_MAG_Counterspell', 1, 0, false, false, context.Source) and not HasStatus('SG_Polymorph')) or (HasActionResource('Interrupt_MAG_Counterspell', 1, 0, false, false, context.Source) and HasAnyStatus({'SG_Disguise','WILDSHAPE_STARRY_ARCHER_PLAYER','WILDSHAPE_STARRY_CHALICE_PLAYER','WILDSHAPE_STARRY_DRAGON_PLAYER'}))"
// data "EnableContext" "OnActionResourcesChanged"
data "EnableContext" "OnActionResourcesChanged;OnStatusApplied;OnStatusRemoved"

// ==================================== Creation's Echo ====================================
// Bug Fix: Damage resistances no longer share a stack with damage resistance elixirs.
// TODO: WIP WIP WIP
// TODO: The weapon gets a damage die buff matching the resistance gained by the wielder.

new entry "UND_SocietyOfBrilliance_ResonanceStaff"
type "Weapon"
// using "WPN_Quarterstaff_1"
using "UND_SocietyOfBrilliance_ResonanceStaff"
// data "RootTemplate" "62da3651-f2e4-4371-b5f2-fd06dd705030"
// data "ItemGroup" ""
// data "ValueUUID" "9b6a4ab2-323b-4030-89ab-030252bb6214"
// data "Rarity" "Rare"
// data "DefaultBoosts" "WeaponProperty(Magical)"
data "DefaultBoosts" "WeaponEnchantment(1);WeaponProperty(Magical)"
// data "PassivesOnEquip" "UND_SocietyOfBrilliance_ResonanceStaff_Passive"
// data "Unique" "1"

new entry "GOON_CREATIONSECHO_WEAPON_THROW_TECHNICAL"
type "StatusData"
data "StatusType" "BOOST"
data "StatusPropertyFlags" "DisablePortraitIndicator;DisableOverhead;DisableCombatlog;IgnoreResting"

new entry "UND_SocietyOfBrilliance_ResonanceStaff_Passive"
type "PassiveData"
// Elemental Resonance
data "DisplayName" "hc8c40c1fg9486g435cgac76g6849e2cd0002;2"
// If the wielder deals Acid, Fire, Lightning, Radiant or Necrotic damage, it becomes resistant to that damage type for 2 turns.
data "Description" "h267003d7g6f6eg426cgabb6gdc1f95ae04e7;2"
data "Properties" "OncePerAttack"
// data "StatsFunctorContext" "OnDamage"
// data "Conditions" "Character() and (HasDamageDoneForType(DamageType.Acid) or HasDamageDoneForType(DamageType.Lightning) or HasDamageDoneForType(DamageType.Fire) or HasDamageDoneForType(DamageType.Necrotic) or HasDamageDoneForType(DamageType.Radiant))"
data "Conditions" "Character()"
// data "StatsFunctors" "IF(HasDamageDoneForType(DamageType.Acid)):ApplyStatus(SELF,RESISTANCE_ACID,100,2);IF(HasDamageDoneForType(DamageType.Lightning)):ApplyStatus(SELF,RESISTANCE_LIGHTNING,100,2);IF(HasDamageDoneForType(DamageType.Fire)):ApplyStatus(SELF,RESISTANCE_FIRE,100,2);IF(HasDamageDoneForType(DamageType.Necrotic)):ApplyStatus(SELF,RESISTANCE_NECROTIC,100,2);IF(HasDamageDoneForType(DamageType.Radiant)):ApplyStatus(SELF,RESISTANCE_RADIANT,100,2)"
data "StatsFunctors" "IF(HasDamageDoneForType(DamageType.Acid,context.Target)):ApplyStatus(SELF,GOON_RESISTANCE_ACID_ELEMENTAL_RESONANCE,100,2);IF(HasDamageDoneForType(DamageType.Fire,context.Target)):ApplyStatus(SELF,RESISTANCE_FIRE_ECHO,100,2);IF(HasDamageDoneForType(DamageType.Lightning,context.Target)):ApplyStatus(SELF,RESISTANCE_LIGHTNING_ECHO,100,2);IF(HasDamageDoneForType(DamageType.Necrotic,context.Target)):ApplyStatus(SELF,RESISTANCE_NECROTIC_ECHO,100,2);IF(HasDamageDoneForType(DamageType.Radiant,context.Target)):ApplyStatus(SELF,RESISTANCE_RADIANT_ECHO,100,2)"

new entry "GOON_ELEMENTAL_RESONANCE_ACID_RESISTANCE"
type "StatusData"
data "StatusType" "BOOST"
using "RESISTANCE_ACID"
// Acid Elemental Resonance
data "DisplayName" "hd780109cg14a6g4fd6g889bg6e427aa20d57;1"
// Acid damage against this entity is halved.
data "Description" "h0f33e8b9gf23dg4c25ga22egc4afeb08a06b;1"
data "StackId" "GOON_ELEMENTAL_RESONANCE"
data "OnApplyFunctors" ""

new entry "GOON_ELEMENTAL_RESONANCE_FIRE_RESISTANCE"
type "StatusData"
data "StatusType" "BOOST"
using "RESISTANCE_FIRE"
// Fire Elemental Resonance
data "DisplayName" "heafcdac6g1866g4b16g80ecgbb0231c853e4;1"
// Fire damage against this entity is halved.
data "Description" "h0f33e8b9gf23dg4c25ga22egc4afeb08a06b;1"
data "StackId" "GOON_ELEMENTAL_RESONANCE"
data "OnApplyFunctors" ""

new entry "GOON_ELEMENTAL_RESONANCE_LIGHTNING_RESISTANCE"
type "StatusData"
data "StatusType" "BOOST"
using "RESISTANCE_LIGHTNING"
// Lightning Elemental Resonance
data "DisplayName" "h85fee4c4gfee3g4351ga925g9a31fd3f5c67;1"
// Lightning damage against this entity is halved.
data "Description" "h2b16ab00g4d4bg49eegb40dg57f254684666;1"
data "StackId" "GOON_ELEMENTAL_RESONANCE"
data "OnApplyFunctors" ""

new entry "GOON_ELEMENTAL_RESONANCE_NECROTIC_RESISTANCE"
type "StatusData"
data "StatusType" "BOOST"
using "RESISTANCE_NECROTIC"
// Necrotic Elemental Resonance
data "DisplayName" "h3fe231eeg9b6ag47c6gb38egb4d69c3331b1;1"
// Necrotic damage against this entity is halved.
data "Description" "he61c2334gc0acg41a6gb6adge3c703f317eb;1"
data "StackId" "GOON_ELEMENTAL_RESONANCE"
data "OnApplyFunctors" ""

new entry "GOON_ELEMENTAL_RESONANCE_RADIANT_RESISTANCE"
type "StatusData"
data "StatusType" "BOOST"
using "RESISTANCE_RADIANT"
// Radiant Elemental Resonance
data "DisplayName" "hef2a0732g9332g450fg8e78gfde7e421f114;1"
// Radiant damage against this entity is halved. Creation's Echo embodies the element, gaining [].
data "Description" "h358b21b7gdc33g4ba5gb895gbb5efd53d858;1"
data "StackId" "GOON_ELEMENTAL_RESONANCE"
data "OnApplyFunctors" "IF(HasStatus('GOON_CREATIONSECHO_WEAPON_THROW_TECHNICAL', GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand, context.Target))):ApplyEquipmentStatus(MeleeMainHand, GOON_SOMETHING, 100, 2);IF(HasStatus('GOON_CREATIONSECHO_WEAPON_THROW_TECHNICAL', GetItemInEquipmentSlot(EquipmentSlot.MeleeOffHand, context.Target))):ApplyEquipmentStatus(MeleeOffHand, GOON_SOMETHING, 100, 2)"