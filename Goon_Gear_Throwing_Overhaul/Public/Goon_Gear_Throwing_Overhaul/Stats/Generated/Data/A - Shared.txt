// ==================================== Master passives for throwing functionality ====================================

// TODO: Figure out something, because MonkWeaponAttackOverride is just ignoring the conditions in boosts, and seemingly stays forever once active.
// new entry "Goon_Finesse_Throwing_Master_Passive"
// type "PassiveData"
// data "Properties" "IsHidden"
// data "BoostConditions" "IsDexterityGreaterThanStrength()"
// data "BoostContext" "OnAttack"
// data "Boosts" "IF(IsRangedUnarmedAttack() and HasWeaponProperty(WeaponProperties.Finesse, context.HitDescription.ThrownObject)):MonkWeaponAttackOverride()"

// Damage reroll: Twist of Fortune, Knife of the Undermountain King, The Clover
new entry "Goon_DamageReroll_Throwing_Master_Passive"
type "PassiveData"
data "Properties" "IsHidden"
data "Boosts" "IF(HasAnyStatus({'GOON_TWISTOFFORTUNE_WEAPON_TECHNICAL','GOON_KNIFEOFTHEUNDERMOUNTAINKING_WEAPON_TECHNICAL','GOON_THECLOVER_WEAPON_TECHNICAL'}, {}, {},context.HitDescription.ThrownObject)):Reroll(Damage,2,true)"

// Ignore Resistance: Adamantine Scimitar, Adamantine Longsword
new entry "Goon_IgnoreResistance_Throwing_Master_Passive"
type "PassiveData"
data "Properties" "IsHidden"
data "Boosts" "IF(HasAnyStatus({'MAG_BYPASS_SLASHING_RESISTANCE_TECHNICAL'}, {}, {},context.HitDescription.ThrownObject)):IgnoreResistance(Slashing, Resistant)"

// TODO: Figure out how to allow advantage for throwing specific weapons
// Advantage: Pelorsun Blade, Gandrel's Aspiration, Hunting Shortbow
// new entry "Goon_Advantage_Throwing_Master_Passive"
// type "PassiveData"
// data "Properties" "IsHidden"
// data "Boosts" "IF(HasStatus('GOON_PELORSUNBLADE_WEAPON_TECHNICAL',context.HitDescription.ThrownObject) and UndeadOrFiend()):Advantage(AttackRoll)"

//  context.HitDescription.AttackType == AttackType.RangedUnarmedAttack

// function IsThrowAttackRoll()
//     local res = IsUnarmedAttack() & SpellTypeIs(SpellType.Throw) & HasWeaponProperty(WeaponProperties.Finesse, context.HitDescription.ThrownObject)
//     return ConditionResult(res.Result)
// end

// ==================================== Adamantine weapons - Adamantine Scimitar, Adamantine Longsword ====================================
// Bug Fix: Resistance is only ignored by the weapon itself.

new entry "MAG_IgnoreSlashingResistance_Passive"
type "PassiveData"
using "MAG_IgnoreSlashingResistance_Passive"
// Lethal Weapon
// data "DisplayName" "h226b6cacgc1a7g451fg9c98g30e3b761fcdc;1"
// This weapon ignores &lt;LSTag Tooltip="Resistant"&gt;Resistance&lt;/LSTag&gt; to Slashing damage.
// data "Description" "h484ad669gd0d2g4ac1g8b26g4139664ff70b;2"
// data "Boosts" "IgnoreResistance(Slashing, Resistant)"
data "Boosts" "IF(HasStatus('MAG_BYPASS_SLASHING_RESISTANCE_TECHNICAL',GetAttackWeapon(context.Source))):IgnoreResistance(Slashing, Resistant)"

// ==================================== Sussur weapons ====================================

new entry "Goon_Sussur_Silence_Passive"
type "PassiveData"
// Sussur Silence
data "DisplayName" "h9546f680ge839g4e56g8c66g7c4497ebc1a1;1"
// Targets hit with this weapon must succeed a &lt;LSTag Tooltip="Constitution"&gt;Constitution&lt;/LSTag&gt; &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throw&lt;/LSTag&gt; or become &lt;LSTag Type="Status" Tooltip="SILENCED"&gt;Silenced&lt;/LSTag&gt; for [1] turns.
data "Description" "hb51441aag0602g4421g8b9cg27b31a9a781c;1"
data "DescriptionParams" "2"
data "TooltipSave" "Constitution"
data "StatsFunctorContext" "OnDamage"
data "Conditions" "AttackedWithPassiveSourceWeapon()"
data "StatsFunctors" "ApplyStatus(GOON_SUSSUR_TECHNICAL_APPLIER,100,0)"

new entry "GOON_SUSSUR_TECHNICAL_APPLIER"
type "StatusData"
data "StatusType" "BOOST"
// Sussur Silence
data "DisplayName" "h9546f680ge839g4e56g8c66g7c4497ebc1a1;1"
// Targets hit with this weapon must succeed a &lt;LSTag Tooltip="Constitution"&gt;Constitution&lt;/LSTag&gt; &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throws&lt;/LSTag&gt; or become &lt;LSTag Type="Status" Tooltip="SILENCED"&gt;Silenced&lt;/LSTag&gt; for 2 turns.
data "Description" "hb51441aag0602g4421g8b9cg27b31a9a781c;1"
data "DescriptionParams" "2"
data "TooltipSave" "Constitution"
data "StatusPropertyFlags" "ExcludeFromPortraitRendering;InitiateCombat;DisablePortraitIndicator;DisableOverhead;DisableCombatlog"
// data "OnApplyRoll" "not SavingThrow(Ability.Constitution, 12)"
data "OnApplyRoll" "not SavingThrow(Ability.Constitution, ManeuverSaveDC()+2)"
data "OnApplySuccess" "ApplyStatus(SILENCED,100,2)"
data "OnApplyFail" ""

// ==================================== Shadow Blade - Knife of the Undermountain King, Justiciar's Scimitar ====================================
// Bug Fix: Shadow Blade's Advantage against obscured targets is only applied to attacks with the weapon itself.
// Note: Necessary to include here as it's a passive used by multiple weapons and not just the summon itself.
// TODO: List all weapons above, and make sure they have the technical, or do a khn check instead.

// Goon's Spell Overhaul level 2 - Commented out and to be revisited.

// ==================================== Vicious weapons - Dolor Amarus, Vicious Battleaxe, Vicious Shortsword, Vicious Shortbow ====================================
// Bug Fix: The Dolor Amarus passive no longer states that it applies to melee attacks when it doesn't.
// Bug Fix: The additional damage only applies to attacking with or throwing the weapon itself.
// Changes: Dolor Amarus passive now works when thrown.

new entry "MAG_Vicious_Weapon_Passive"
type "PassiveData"
using "MAG_Vicious_Weapon_Passive"
// When you land a &lt;LSTag Tooltip="CriticalHit"&gt;Critical Hit&lt;/LSTag&gt; with a weapon or unarmed attack, it deals an additional [1] damage.
// data "Description" "hbea31881gb41cg4adagbd4cg6fc6bd561bf2;4"
// When you land a &lt;LSTag Tooltip="CriticalHit"&gt;Critical Hit&lt;/LSTag&gt; with this weapon, it deals an additional [1] damage.
data "Description" "hc6c42992g8252g42bdg98d0ge95b7eebf1f9;1"
data "DescriptionParams" "7"
// data "BoostContext" "OnCreate"
data "BoostContext" ""
data "BoostConditions" "AttackedWithPassiveSourceWeapon()"
data "Boosts" "IF(IsWeaponAttack() and IsCritical()):DamageBonus(7,,false)"

// ==================================== Infernal weapons ====================================
// Changes: Lesser infernal weapons deal 1d6 Poison damage instead of a flat 3. 

new entry "MAG_LESSER_INFERNAL_WEAPON"
type "StatusData"
data "StatusType" "BOOST"
// using "MAG_INFERNAL_WEAPON"
using "MAG_LESSER_INFERNAL_WEAPON"
// data "DescriptionParams" "DealDamage(3,Poison)"
data "DescriptionParams" "DealDamage(1d6,Poison)"
// data "Boosts" "WeaponDamage(3, Poison)"
data "Boosts" "WeaponDamage(1d6,Poison)"

new entry "MAG_INFERNAL_WEAPON"
type "StatusData"
data "StatusType" "BOOST"
// using "DIPPED_POISON"
using "MAG_INFERNAL_WEAPON"
// Infernal Weapon
// data "DisplayName" "h6816720eg3126g4738gabb9g87c8001186a6;2"
// On a hit, the affected entity deals an additional [1] and can possibly <LSTag Type="Status" Tooltip="POISONED">Poison</LSTag> its target. 
// data "Description" "h39186345gdb1eg4965g82ccg354ce3573fbd;3"
// data "DescriptionParams" "DealDamage(6,Poison)"
data "DescriptionParams" "DealDamage(1d10,Poison)"
// data "Icon" "GenericIcon_DamageType_Poison"
// data "StackId" "MAG_INFERNAL_WEAPON"
// data "Boosts" "WeaponDamage(6, Poison)"
data "Boosts" "WeaponDamage(1d10,Poison)"
// data "Passives" "MAG_Infernal_Weapon_Passive"
// data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator;IgnoreResting"
// data "StatusEffect" "11f94ff7-9c1b-431a-a26b-99e157026dee"

// Hellbeard Halberd
new entry "MAG_Infernal_Weapon_Passive"
type "PassiveData"
using "MAG_Infernal_Weapon_Passive"
// Malebolge Stinger
// data "DisplayName" "h9e579063gc086g4828g8837g5b3067d8554d;1"
// On a hit, possibly inflict &lt;LSTag Type="Status" Tooltip="POISONED"&gt;Poisoned&lt;/LSTag&gt;.
// data "Description" "h11a618a5g6bd5g4d48gaba1gfc7784d80d99;1"
// On a hit, possibly inflict &lt;LSTag Type="Status" Tooltip="POISONED"&gt;Poisoned&lt;/LSTag&gt; for [1] turns.
data "Description" "hc4d3de99ge275g4176gb149g91a4e61e5488;1"
data "DescriptionParams" "2"
data "TooltipSave" "Constitution"
// data "StatsFunctorContext" "OnDamage"
// data "Conditions" "AttackedWithPassiveSourceWeapon()"
// data "StatsFunctors" "ApplyStatus(POISONED, 100, 2,,,,not SavingThrow(Ability.Constitution,12))"
data "StatsFunctors" "ApplyStatus(GOON_INFERNAL_WEAPON_TECHNICAL_APPLIER, 100, 0)"

new entry "GOON_INFERNAL_WEAPON_TECHNICAL_APPLIER"
type "StatusData"
data "StatusType" "BOOST"
// Malebolge Stinger
data "DisplayName" "h9e579063gc086g4828g8837g5b3067d8554d;1"
// On a hit, possibly inflict &lt;LSTag Type="Status" Tooltip="POISONED"&gt;Poisoned&lt;/LSTag&gt; for [1] turns.
data "Description" "hc4d3de99ge275g4176gb149g91a4e61e5488;1"
data "DescriptionParams" "2"
data "TooltipSave" "Constitution"
data "StatusPropertyFlags" "ExcludeFromPortraitRendering;InitiateCombat;DisablePortraitIndicator;DisableOverhead;DisableCombatlog"
data "OnApplyRoll" "not SavingThrow(Ability.Constitution, 13, AdvantageOnPoisoned())"
data "OnApplySuccess" "ApplyStatus(POISONED, 100, 2)"

// ==================================== The Sparky Points & The Jolt Shooter ====================================

new entry "GOON_CHARGEDLIGHTNING_WEAPON_THROW_TECHNICAL"
type "StatusData"
data "StatusType" "BOOST"
data "StatusPropertyFlags" "DisablePortraitIndicator;DisableOverhead;DisableCombatlog;IgnoreResting"

new entry "GOON_CHARGEDLIGHTNING_TECHNICAL_APPLIER"
type "StatusData"
data "StatusType" "BOOST"
// Electric Blood
data "DisplayName" "hefe38517g8993g4b98g94ccgb6a7d7274d76;2"
// When the wielder deals damage using this weapon, they gain [1] &lt;LSTag Type="Status" Tooltip="MAG_CHARGED_LIGHTNING"&gt;Lightning Charges&lt;/LSTag&gt;.
data "Description" "hfceeb862gbcb0g49cag8b9bgdeb29686304f;4"
data "StatusPropertyFlags" "ExcludeFromPortraitRendering;InitiateCombat;DisablePortraitIndicator;DisableOverhead;DisableCombatlog"
data "OnApplyFunctors" "IF(Character() and not HasStatus('MAG_CHARGED_LIGHTNING', context.Source)):ApplyStatus(SWAP, MAG_CHARGED_LIGHTNING_LIGHTNING_DAMAGE_ONCE_TECHNICAL,100, 0);IF(Character()):ApplyStatus(SWAP, MAG_CHARGED_LIGHTNING_GENERATE_CHARGE_FX, 100, 0);IF(Character() and not IsDischargingLightning(context.Source)):ApplyStatus(SWAP, MAG_CHARGED_LIGHTNING,100, 2);IF(Character()):ApplyStatus(SWAP, MAG_CHARGED_LIGHTNING_DURATION_TECHNICAL, 100, 1)"

// ==================================== Shield bashes ====================================
// Bug Fix: Now uses Maneuver Save DC instead of Spell Save DC.
// Bug Fix: Can be used while under the effects of more non-hostile Polymorphs, but requires a shield to be equipped.
// Changes: Can now be used by Invisible player characters.

new entry "Target_Bash"
type "SpellData"
data "SpellType" "Target"
using "Target_Bash"
// data "AIFlags" "CanNotUse"
data "AIFlags" ""
// data "TargetCeiling" "0"
// data "TargetFloor" ".25"
// data "TargetRadius" "MeleeMainWeaponRange"
// data "SpellRoll" "not SavingThrow(Ability.Strength, SourceSpellDC())"
data "SpellRoll" "not SavingThrow(Ability.Strength, ManeuverSaveDC())"
// data "SpellSuccess" "ApplyStatus(PRONE,100,1)"
// data "SpellFail" "ApplyStatus(SAVED_AGAINST_HOSTILE_SPELL, 100, 0)"
// data "TargetConditions" "Character() and not Self()"
// data "Icon" "Action_Bash"
// Bash
// data "DisplayName" "hcda66a1fgc07bg428ega1e6g1492143c9d7d;1"
// Bash your shield against a target to knock it &lt;LSTag Type="Status" Tooltip="PRONE"&gt;Prone&lt;/LSTag&gt;.
// data "Description" "h3e8b7cf5g454ag4529g86dfg5b795879914d;2"
// Bash your shield against a target to knock it &lt;LSTag Type="Status" Tooltip="PRONE"&gt;Prone&lt;/LSTag&gt; for [1] turn.
data "Description" "h497fe29fg16bbg4e99gbc14g25a76f87c9c8;1"
data "DescriptionParams" "1"
// data "TooltipAttackSave" "Strength"
// data "TooltipStatusApply" "ApplyStatus(PRONE,100,1)"
// data "CastSound" "Action_Cast_Bash"
// data "TargetSound" "Action_Impact_Bash"
// data "PreviewCursor" "Melee"
// data "CastTextEvent" "CastOffhand"
// data "UseCosts" "ActionPoint:1"
// data "SpellAnimation" "8b8bb757-21ce-4e02-a2f3-97d55cf2f90b,,;c1df9aea-8be9-4de3-bcbc-4e4c1e44dc37,,;722df2d7-7898-4b0b-b930-5a850b55ccf0,722df2d7-7898-4b0b-b930-5a850b55ccf0,722df2d7-7898-4b0b-b930-5a850b55ccf0;a693a7c3-e7e7-4edb-98dd-db5fd700663f,,;7bb52cd4-0b1c-4926-9165-fa92b75876a3,,;c1df9aea-8be9-4de3-bcbc-4e4c1e44dc37,,;0b07883a-08b8-43b6-ac18-84dc9e84ff50,,;,,;,,"
// data "DualWieldingSpellAnimation" "1d832b0a-ccfe-4ca7-8426-10200306921c,,;c1df9aea-8be9-4de3-bcbc-4e4c1e44dc37,,;722df2d7-7898-4b0b-b930-5a850b55ccf0,,;a693a7c3-e7e7-4edb-98dd-db5fd700663f,,;cbe217f4-bca8-46c0-bb22-c846b18e13a1,,;35f5cba8-3706-46d5-9a1e-2def9ba22473,,;,,;,,;,,"
// data "VerbalIntent" "Control"
// data "WeaponTypes" "Melee"
// data "SpellFlags" "IsMelee;IsHarmful;IsDefaultWeaponAction"
// data "RechargeValues" "5-6"
data "RechargeValues" ""
// data "HitAnimationType" "PhysicalDamage"
// data "SpellAnimationIntentType" "Aggressive"
// data "PrepareEffect" "e1cc173f-b12f-4060-b8ea-57b891dd30fe"
// data "CastEffect" "468f6e0e-222f-4ea6-8572-10ff14f2c422"
// data "TargetEffect" "6f92ffb6-d1b8-4818-a691-a030e3e39952"
// data "Sheathing" "Melee"

new entry "Target_ShieldBlow_Riposte"
type "SpellData"
data "SpellType" "Target"
// using "Target_Bash"
using "Target_ShieldBlow_Riposte"
// Shield Blow
// data "DisplayName" "ha0b4f218g3fbfg44c8gb871g7508b6e84444;1"
// When struck by a melee attack, your attacker must succeed a Dexterity &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throw&lt;/LSTag&gt; or fall &lt;LSTag Type="Status" Tooltip="PRONE"&gt;Prone&lt;/LSTag&gt;.
// data "Description" "h1e2b5e63ga607g41d7gb85cg361a99036ec6;1"
// When struck by a melee attack you may bash your shield against the attacker. They must succeed a &lt;LSTag Tooltip="Dexterity"&gt;Dexterity&lt;/LSTag&gt; &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throw&lt;/LSTag&gt; or fall &lt;LSTag Type="Status" Tooltip="PRONE"&gt;Prone&lt;/LSTag&gt; for [1] turn.
data "Description" "h0c55dbc7gccedg4ae3g94efg17167ffc09f9;1"
data "DescriptionParams" "1"
// data "SpellAnimationIntentType" "Aggressive"

new entry "Interrupt_ShieldBlow"
type "InterruptData"
// using "Interrupt_Riposte"
using "Interrupt_ShieldBlow"
// Shield Blow
// data "DisplayName" "h56473724ga6e4g4490gb397g1f83bf984d8c;2"
// When struck by a melee attack, your attacker must succeed a Dexterity &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throw&lt;/LSTag&gt; or fall &lt;LSTag Type="Status" Tooltip="PRONE"&gt;Prone&lt;/LSTag&gt;.
// data "Description" "h244342b5ge15eg44bfg8495gfe2d53029b3b;2"
// When struck by a melee attack you may bash your shield against the attacker. They must succeed a &lt;LSTag Tooltip="Dexterity"&gt;Dexterity&lt;/LSTag&gt; &lt;LSTag Tooltip="SavingThrow"&gt;Saving Throw&lt;/LSTag&gt; or fall &lt;LSTag Type="Status" Tooltip="PRONE"&gt;Prone&lt;/LSTag&gt; for [1] turn.
data "Description" "h0c55dbc7gccedg4ae3g94efg17167ffc09f9;1"
data "DescriptionParams" "1"
// data "Icon" "Action_Bash"
// data "Conditions" "IsAbleToReact(context.Observer) and Enemy(context.Source,context.Observer) and IsMeleeAttack() and (IsHit() or IsCritical()) and not HasStatus('INVISIBILITY') and HasLastAttackTriggered()"
data "Conditions" "(Player(context.Observer) or not HasStatus('SG_Invisible',context.Observer)) and IsAbleToReact(context.Observer) and Enemy(context.Source,context.Observer) and IsMeleeAttack() and (IsHit() or IsCritical()) and HasLastAttackTriggered()"
// data "Properties" "UseSpell(SWAP,Target_ShieldBlow_Riposte,true,true,true);ApplyStatus(OBSERVER_OBSERVER,INTERRUPT_RIPOSTE,100,0)"
// data "Cost" "ReactionActionPoint:1"
// data "EnableCondition" "not HasAnyStatus({'SG_Polymorph','SG_Blinded'}) or HasAnyStatus({'SG_Disguise','WILDSHAPE_STARRY_ARCHER_PLAYER','WILDSHAPE_STARRY_CHALICE_PLAYER','WILDSHAPE_STARRY_DRAGON_PLAYER'});"
data "EnableCondition" "(not HasStatus('SG_Polymorph') or Goon_IsNonHostilePolymorphStatus()) and not HasStatus('SG_Blinded') and HasShieldEquipped(context.Source)"
// data "Cooldown" "OncePerTurn"
// data "InterruptDefaultValue" "Enabled;Ask"
data "InterruptFlags" "InterruptWhileInvisible"
